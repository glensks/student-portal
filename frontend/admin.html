<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard ‚Äì University of Manila</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
    --forest-900: #1b4332;
    --forest-800: #2d6a4f;
    --forest-700: #40916c;
    --forest-600: #52b788;
    --forest-500: #74c69d;
    --forest-400: #95d5b2;
    --gold: #c9a84c;
    --gold-light: #e8c97a;
    --cream: #f8f5f0;
    --cream-dark: #ede9e2;
    --text-dark: #1a1a2e;
    --text-mid: #3d4451;
    --text-light: #6b7280;
    --white: #ffffff;
    --red: #c0392b;
    --red-light: #e74c3c;
    --sidebar-w: 240px;
    --header-h: 72px;
    --footer-h: 48px;
}

* { box-sizing: border-box; margin: 0; padding: 0; }
body {
    font-family: 'DM Sans', sans-serif;
    background: var(--cream);
    color: var(--text-dark);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

/* ===== HEADER ===== */
.site-header {
    position: fixed;
    top: 0; left: 0; right: 0;
    height: var(--header-h);
    background: var(--forest-900);
    z-index: 200;
    display: flex;
    align-items: center;
    padding: 0 24px 0 0;
    box-shadow: 0 2px 12px rgba(0,0,0,0.35);
    border-bottom: 3px solid var(--gold);
}
.header-logo-block {
    width: var(--sidebar-w);
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 0 20px;
    border-right: 1px solid rgba(255,255,255,0.12);
    height: 100%;
}
.header-seal {
    width: 46px;
    height: 46px;
    border-radius: 50%;
    background: var(--gold);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    box-shadow: 0 0 0 2px var(--gold-light), 0 0 0 4px rgba(201,168,76,0.3);
    font-size: 22px;
}
.header-logo-text {
    line-height: 1.15;
}
.header-logo-text .univ-name {
    font-family: 'Playfair Display', serif;
    font-size: 13px;
    font-weight: 700;
    color: var(--white);
    letter-spacing: 0.02em;
}
.header-logo-text .univ-sub {
    font-size: 10px;
    color: var(--forest-400);
    letter-spacing: 0.06em;
    text-transform: uppercase;
    font-weight: 500;
}
.header-center {
    flex: 1;
    display: flex;
    align-items: center;
    padding-left: 24px;
    gap: 8px;
}
.header-badge {
    background: var(--forest-800);
    color: var(--forest-400);
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding: 4px 12px;
    border-radius: 20px;
    border: 1px solid var(--forest-700);
}
.header-title {
    font-family: 'Playfair Display', serif;
    font-size: 18px;
    font-weight: 600;
    color: var(--white);
    letter-spacing: 0.01em;
}
.header-right {
    display: flex;
    align-items: center;
    gap: 16px;
}
.header-clock {
    text-align: right;
}
.header-clock .time {
    font-size: 16px;
    font-weight: 600;
    color: var(--gold-light);
    font-variant-numeric: tabular-nums;
    letter-spacing: 0.05em;
}
.header-clock .date {
    font-size: 11px;
    color: var(--forest-400);
    letter-spacing: 0.04em;
}
.header-divider {
    width: 1px;
    height: 30px;
    background: rgba(255,255,255,0.15);
}
.header-user {
    display: flex;
    align-items: center;
    gap: 10px;
}
.header-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--forest-700);
    border: 2px solid var(--gold);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    color: var(--white);
}
.header-user-info .name {
    font-size: 13px;
    font-weight: 600;
    color: var(--white);
}
.header-user-info .role-label {
    font-size: 10px;
    color: var(--forest-400);
    text-transform: uppercase;
    letter-spacing: 0.06em;
}

/* ===== SIDEBAR ===== */
.sidebar {
    width: var(--sidebar-w);
    background: var(--forest-900);
    position: fixed;
    top: var(--header-h);
    bottom: var(--footer-h);
    left: 0;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    border-right: 1px solid rgba(255,255,255,0.07);
    z-index: 100;
}
.sidebar-section {
    padding: 16px 14px 8px;
}
.sidebar-section-label {
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--forest-600);
    padding: 0 8px;
    margin-bottom: 6px;
}
.sidebar-btn {
    background: none;
    border: none;
    color: rgba(255,255,255,0.75);
    text-align: left;
    padding: 10px 12px;
    width: 100%;
    cursor: pointer;
    font-size: 13.5px;
    font-family: 'DM Sans', sans-serif;
    font-weight: 500;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.2s;
    letter-spacing: 0.01em;
    margin-bottom: 2px;
}
.sidebar-btn:hover {
    background: rgba(255,255,255,0.08);
    color: var(--white);
}
.sidebar-btn.active {
    background: var(--forest-800);
    color: var(--white);
    box-shadow: inset 3px 0 0 var(--gold);
}
.sidebar-btn .icon {
    font-size: 16px;
    width: 20px;
    text-align: center;
    flex-shrink: 0;
}
.sidebar-logout {
    margin-top: auto;
    padding: 14px;
    border-top: 1px solid rgba(255,255,255,0.08);
}
.sidebar-logout button {
    background: rgba(192,57,43,0.15);
    border: 1px solid rgba(192,57,43,0.35);
    color: #e88;
    text-align: center;
    padding: 10px;
    width: 100%;
    cursor: pointer;
    font-size: 13.5px;
    font-family: 'DM Sans', sans-serif;
    font-weight: 600;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.2s;
    letter-spacing: 0.02em;
}
.sidebar-logout button:hover {
    background: rgba(192,57,43,0.3);
    color: #faa;
}

/* ===== MAIN ===== */
.main {
    margin-left: var(--sidebar-w);
    margin-top: var(--header-h);
    margin-bottom: var(--footer-h);
    padding: 28px;
    min-height: calc(100vh - var(--header-h) - var(--footer-h));
}
.page-heading {
    margin-bottom: 24px;
    display: flex;
    align-items: flex-end;
    gap: 16px;
    border-bottom: 2px solid var(--cream-dark);
    padding-bottom: 16px;
}
.page-heading h1 {
    font-family: 'Playfair Display', serif;
    font-size: 28px;
    font-weight: 700;
    color: var(--forest-900);
}
.page-heading .subtitle {
    font-size: 13px;
    color: var(--text-light);
    margin-bottom: 4px;
}

/* ===== STATS CARDS ===== */
.stats-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 16px;
    margin-bottom: 28px;
}
.stat-card {
    background: var(--white);
    padding: 20px 22px;
    border-radius: 12px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.07);
    border-left: 4px solid var(--forest-600);
    transition: transform 0.2s, box-shadow 0.2s;
    position: relative;
    overflow: hidden;
}
.stat-card::before {
    content: '';
    position: absolute;
    top: -20px; right: -20px;
    width: 70px; height: 70px;
    border-radius: 50%;
    background: var(--forest-400);
    opacity: 0.08;
}
.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 14px rgba(0,0,0,0.1);
}
.stat-card h3 {
    font-size: 11px;
    font-weight: 600;
    color: var(--text-light);
    text-transform: uppercase;
    letter-spacing: 0.07em;
    margin-bottom: 8px;
}
.stat-card .number {
    font-size: 34px;
    font-weight: 700;
    color: var(--forest-800);
    font-variant-numeric: tabular-nums;
    font-family: 'Playfair Display', serif;
}
.stat-card:nth-child(2) { border-left-color: var(--gold); }
.stat-card:nth-child(2) .number { color: var(--gold); }
.stat-card:nth-child(3) { border-left-color: var(--forest-700); }
.stat-card:nth-child(4) { border-left-color: #5b8def; }
.stat-card:nth-child(4) .number { color: #5b8def; }
.stat-card:nth-child(5) { border-left-color: var(--forest-500); }
.stat-card:nth-child(6) { border-left-color: #aaa; }
.stat-card:nth-child(6) .number { color: #aaa; }

/* ===== TABLE ===== */
.table-wrapper {
    background: var(--white);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 1px 4px rgba(0,0,0,0.07);
    border: 1px solid var(--cream-dark);
}
table { width: 100%; border-collapse: collapse; }
th {
    background: var(--forest-900);
    color: rgba(255,255,255,0.9);
    padding: 13px 14px;
    text-align: left;
    font-size: 12px;
    font-weight: 600;
    letter-spacing: 0.06em;
    text-transform: uppercase;
}
td {
    padding: 11px 14px;
    font-size: 13.5px;
    border-bottom: 1px solid var(--cream-dark);
    vertical-align: middle;
}
tr:last-child td { border-bottom: none; }
tr:hover td { background: #f0f7f4; }

/* ===== BUTTONS ===== */
.action-btn {
    padding: 5px 11px;
    margin-right: 4px;
    margin-bottom: 3px;
    cursor: pointer;
    border: none;
    border-radius: 5px;
    font-size: 12px;
    font-family: 'DM Sans', sans-serif;
    font-weight: 600;
    transition: opacity 0.15s, transform 0.1s;
    display: inline-block;
}
.action-btn:hover { opacity: 0.85; transform: translateY(-1px); }
.btn-edit { background: var(--forest-700); color: white; }
.btn-delete { background: var(--red-light); color: white; }
.btn-reset { background: var(--gold); color: #3a2800; }
.btn-details { background: var(--forest-800); color: white; }
.btn-activate { background: var(--forest-600); color: white; }
.btn-deactivate { background: #95a5a6; color: white; }
.btn-approve { background: var(--forest-600); color: white; }
.btn-reject { background: var(--red); color: white; }
.btn-pending { background: var(--gold); color: #3a2800; }

/* ===== SEARCH BAR ===== */
.search-container {
    margin-bottom: 18px;
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
}
.search-container input, .search-container select {
    padding: 9px 14px;
    border: 1.5px solid var(--cream-dark);
    border-radius: 8px;
    font-family: 'DM Sans', sans-serif;
    font-size: 13.5px;
    background: var(--cream);
    transition: border-color 0.2s;
    outline: none;
}
.search-container input:focus, .search-container select:focus {
    border-color: var(--forest-600);
}
.search-container input { width: 300px; }
.search-container button {
    padding: 9px 18px;
    background: var(--forest-700);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 13.5px;
    font-family: 'DM Sans', sans-serif;
    font-weight: 600;
    transition: background 0.2s;
}
.search-container button:hover { background: var(--forest-800); }

/* ===== POPUPS ===== */
.popup {
    display: none;
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: var(--white);
    padding: 28px 32px;
    border-radius: 14px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.2);
    max-width: 600px;
    width: 100%;
    z-index: 1000;
    max-height: 90vh;
    overflow-y: auto;
    border-top: 4px solid var(--forest-700);
}
.popup h3 {
    margin-bottom: 20px;
    color: var(--forest-900);
    font-family: 'Playfair Display', serif;
    font-size: 20px;
    font-weight: 700;
    border-bottom: 1px solid var(--cream-dark);
    padding-bottom: 12px;
}
.popup label {
    display: block;
    margin: 10px 0 4px;
    font-weight: 600;
    color: var(--text-mid);
    font-size: 13px;
    letter-spacing: 0.02em;
}
.popup input, .popup select, .popup textarea {
    width: 100%;
    padding: 10px 13px;
    margin-bottom: 10px;
    border: 1.5px solid var(--cream-dark);
    border-radius: 8px;
    font-family: 'DM Sans', sans-serif;
    font-size: 13.5px;
    outline: none;
    transition: border-color 0.2s;
    background: var(--cream);
}
.popup input:focus, .popup select:focus { border-color: var(--forest-600); }
.popup button {
    padding: 10px 18px;
    margin-right: 8px;
    cursor: pointer;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-family: 'DM Sans', sans-serif;
    font-size: 13.5px;
    transition: opacity 0.15s;
}
.popup button:hover { opacity: 0.88; }
.popup .submit-btn { background: var(--forest-700); color: white; }
.popup .close-btn { background: var(--cream-dark); color: var(--text-mid); }

/* Form Grid */
.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.form-grid-full { grid-column: 1 / -1; }

/* User Details Card */
.user-details { background: var(--cream); padding: 16px 18px; border-radius: 10px; margin-bottom: 16px; border: 1px solid var(--cream-dark); }
.user-details p { margin: 7px 0; font-size: 13.5px; }
.user-details strong { color: var(--forest-800); margin-right: 6px; }

/* Status Badges */
.status-badge {
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 11.5px;
    font-weight: 700;
    letter-spacing: 0.04em;
    display: inline-block;
}
.status-active { background: #d1fae5; color: #065f46; }
.status-inactive { background: #f3f4f6; color: #6b7280; }
.status-approved { background: #d1fae5; color: #065f46; }
.status-pending { background: #fef3c7; color: #92400e; }
.status-rejected { background: #fee2e2; color: #991b1b; }

/* Bulk Actions */
.bulk-actions { margin: 15px 0; padding: 14px; background: var(--cream); border-radius: 8px; border: 1px solid var(--cream-dark); }
.bulk-actions button { margin-right: 10px; }

/* Overlay */
.overlay {
    position: fixed;
    inset: 0;
    background: rgba(27,67,50,0.45);
    backdrop-filter: blur(2px);
    display: none;
    z-index: 900;
}

/* Checkbox */
input[type="checkbox"] { width: auto; margin-right: 5px; accent-color: var(--forest-700); }
.required { color: var(--red-light); }
.help-text { font-size: 12px; color: var(--text-light); margin-top: -8px; margin-bottom: 10px; }
.profile-pic { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid var(--forest-400); }

/* ===== FOOTER ===== */
.site-footer {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    height: var(--footer-h);
    background: var(--forest-900);
    border-top: 2px solid var(--forest-800);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 24px 0 calc(var(--sidebar-w) + 24px);
    z-index: 200;
}
.footer-copy {
    font-size: 11.5px;
    color: var(--forest-500);
    letter-spacing: 0.03em;
}
.footer-copy strong {
    color: var(--gold-light);
    font-weight: 600;
}
.footer-links {
    display: flex;
    gap: 16px;
    align-items: center;
}
.footer-links span {
    font-size: 11px;
    color: var(--forest-600);
    letter-spacing: 0.04em;
    padding: 4px 10px;
    border-radius: 4px;
    border: 1px solid var(--forest-800);
}

/* Welcome hero */
.welcome-hero {
    background: linear-gradient(135deg, var(--forest-900) 0%, var(--forest-800) 60%, var(--forest-700) 100%);
    border-radius: 14px;
    padding: 28px 32px;
    margin-bottom: 28px;
    color: white;
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 16px rgba(27,67,50,0.25);
}
.welcome-hero::before {
    content: 'üéì';
    position: absolute;
    right: 24px; top: 50%;
    transform: translateY(-50%);
    font-size: 80px;
    opacity: 0.12;
}
.welcome-hero h2 {
    font-family: 'Playfair Display', serif;
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 6px;
    letter-spacing: 0.01em;
}
.welcome-hero p {
    font-size: 13.5px;
    color: var(--forest-400);
    letter-spacing: 0.02em;
}
.welcome-hero .gold-accent {
    color: var(--gold-light);
    font-weight: 600;
}

/* Quick actions strip */
.quick-hint {
    color: var(--text-light);
    font-size: 13.5px;
    margin-top: 8px;
    padding: 14px 18px;
    background: var(--white);
    border-radius: 10px;
    border-left: 4px solid var(--forest-500);
    box-shadow: 0 1px 4px rgba(0,0,0,0.05);
}

/* Scrollbar */
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--forest-400); border-radius: 3px; }
</style>
</head>
<body>

<!-- ===== HEADER ===== -->
<header class="site-header">
    <div class="header-logo-block">
        <div class="header-seal">üèõÔ∏è</div>
        <div class="header-logo-text">
            <div class="univ-name">University of Manila</div>
            <div class="univ-sub">Est. 1913 ¬∑ Manila, Philippines</div>
        </div>
    </div>
    <div class="header-center">
        <span class="header-badge">Admin Portal</span>
        <span class="header-title">Student Information System</span>
    </div>
    <div class="header-right">
        <div class="header-clock">
            <div class="time" id="clockTime">--:--:--</div>
            <div class="date" id="clockDate">Loading...</div>
        </div>
        <div class="header-divider"></div>
        <div class="header-user">
            <div class="header-avatar">üë§</div>
            <div class="header-user-info">
                <div class="name">Administrator</div>
                <div class="role-label">System Admin</div>
            </div>
        </div>
    </div>
</header>

<!-- ===== SIDEBAR ===== -->
<div class="sidebar">
    <div class="sidebar-section">
        <div class="sidebar-section-label">Overview</div>
        <button class="sidebar-btn active" onclick="showDashboard()">
            <span class="icon">üìä</span> Dashboard
        </button>
    </div>

    <div class="sidebar-section">
        <div class="sidebar-section-label">User Management</div>
        <button class="sidebar-btn" onclick="openForm('formCreateUser')">
            <span class="icon">‚ûï</span> Create User
        </button>
        <button class="sidebar-btn" onclick="openForm('formViewUsers')">
            <span class="icon">üë•</span> View Users
        </button>
        <button class="sidebar-btn" onclick="openForm('formSearchUsers')">
            <span class="icon">üîç</span> Search Users
        </button>
        <button class="sidebar-btn" onclick="openForm('formBulkActions')">
            <span class="icon">‚ö°</span> Bulk Actions
        </button>
    </div>

    <div class="sidebar-section">
        <div class="sidebar-section-label">Students</div>
        <button class="sidebar-btn" onclick="openForm('formViewStudents')">
            <span class="icon">üéì</span> View Students
        </button>
        <button class="sidebar-btn" onclick="openForm('formSearchStudents')">
            <span class="icon">üîé</span> Search Students
        </button>
    </div>

    <div class="sidebar-logout">
        <button onclick="logout()">üö™ Logout</button>
    </div>
</div>

<!-- ===== MAIN ===== -->
<div class="main">
    <div id="dashboardView">
        <div class="welcome-hero">
            <h2>Welcome back, <span class="gold-accent">Administrator</span></h2>
            <p>University of Manila ‚Äî Student Information System &nbsp;¬∑&nbsp; Academic Year 2025‚Äì2026</p>
        </div>

        <div class="stats-container" id="statsContainer">
            <div class="stat-card">
                <h3>Total Users</h3>
                <div class="number" id="statTotalUsers">‚Äì</div>
            </div>
            <div class="stat-card">
                <h3>Active Users</h3>
                <div class="number" id="statActiveUsers">‚Äì</div>
            </div>
            <div class="stat-card">
                <h3>Students</h3>
                <div class="number" id="statTotalStudentsTable">‚Äì</div>
            </div>
            <div class="stat-card">
                <h3>Teachers</h3>
                <div class="number" id="statTeachers">‚Äì</div>
            </div>
            <div class="stat-card">
                <h3>Admins</h3>
                <div class="number" id="statAdmins">‚Äì</div>
            </div>
            <div class="stat-card">
                <h3>Inactive Users</h3>
                <div class="number" id="statInactiveUsers">‚Äì</div>
            </div>
        </div>

        <div class="quick-hint">
            üìå Select an action from the sidebar to manage users, students, and system settings.
        </div>
    </div>
</div>

<!-- ===== FOOTER ===== -->
<footer class="site-footer">
    <div class="footer-copy">
        &copy; 2025 <strong>University of Manila</strong> &nbsp;¬∑&nbsp; All rights reserved &nbsp;¬∑&nbsp; Student Information System
    </div>
    <div class="footer-links">
        <span>v2.0.0</span>
        <span>SIS Admin Module</span>
    </div>
</footer>

<!-- ===== OVERLAY ===== -->
<div class="overlay" id="overlay" onclick="closeAllForms()"></div>

<!-- ===== POPUPS ===== -->

<!-- Create User -->
<div id="formCreateUser" class="popup" style="max-width: 700px;">
    <h3>‚ûï Create User</h3>
    <div class="form-grid">
        <div>
            <label>First Name <span class="required">*</span></label>
            <input type="text" id="userFirstName" placeholder="Juan">
        </div>
        <div>
            <label>Middle Name</label>
            <input type="text" id="userMiddleName" placeholder="Santos (optional)">
        </div>
    </div>
    <div class="form-grid">
        <div>
            <label>Surname <span class="required">*</span></label>
            <input type="text" id="userSurname" placeholder="Dela Cruz">
        </div>
        <div>
            <label>Username <span class="required">*</span></label>
            <input type="text" id="userUsername" placeholder="jdelacruz">
        </div>
    </div>
    <label>Email <span class="required">*</span></label>
    <input type="email" id="userEmail" placeholder="juan.delacruz@um.edu.ph">
    <label>Contact Number <span class="required">*</span></label>
    <input type="tel" id="userContactNumber" placeholder="+639171234567">
    <div class="form-grid">
        <div>
            <label>Password <span class="required">*</span></label>
            <input type="password" id="userPassword">
        </div>
        <div>
            <label>Role <span class="required">*</span></label>
            <select id="userRole">
                <option value="">Select Role</option>
                <option value="admin">Admin</option>
                <option value="teacher">Teacher</option>
                <option value="student">Student</option>
                <option value="registrar">Registrar</option>
                <option value="cashier">Cashier</option>
                <option value="records">Records</option>
                <option value="faculty">Faculty</option>
            </select>
        </div>
    </div>
    <div style="margin-top: 18px;">
        <button class="submit-btn" id="submitCreateUser">Create User</button>
        <button class="close-btn" onclick="closeForm('formCreateUser')">Cancel</button>
    </div>
</div>

<!-- View Users -->
<div id="formViewUsers" class="popup" style="max-width: 95%; max-height: 90vh;">
    <h3>üë• Manage Users</h3>
    <div class="search-container">
        <select id="filterRole" onchange="loadUsers()">
            <option value="">All Roles</option>
            <option value="admin">Admin</option>
            <option value="teacher">Teacher</option>
            <option value="student">Student</option>
            <option value="registrar">Registrar</option>
            <option value="cashier">Cashier</option>
            <option value="records">Records</option>
            <option value="faculty">Faculty</option>
        </select>
        <select id="filterStatus" onchange="loadUsers()">
            <option value="">All Status</option>
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
        </select>
        <button onclick="loadUsers()">üîÑ Refresh</button>
    </div>
    <div style="overflow-x: auto;">
        <div class="table-wrapper">
            <table id="usersTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Contact</th>
                        <th>Username</th>
                        <th>Role</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="userTableBody"></tbody>
            </table>
        </div>
    </div>
    <button class="close-btn" onclick="closeForm('formViewUsers')" style="margin-top: 16px;">Close</button>
</div>

<!-- View Students -->
<div id="formViewStudents" class="popup" style="max-width: 95%; max-height: 90vh;">
    <h3>üéì Manage Students</h3>
    <div class="search-container">
        <select id="filterStudentStatus" onchange="loadStudents()">
            <option value="">All Status</option>
            <option value="approved">Approved</option>
            <option value="pending">Pending</option>
            <option value="rejected">Rejected</option>
        </select>
        <button onclick="loadStudents()">üîÑ Refresh</button>
    </div>
    <div style="overflow-x: auto;">
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Student ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Contact</th>
                        <th>Age</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="studentTableBody"></tbody>
            </table>
        </div>
    </div>
    <button class="close-btn" onclick="closeForm('formViewStudents')" style="margin-top: 16px;">Close</button>
</div>

<!-- Search Users -->
<div id="formSearchUsers" class="popup" style="max-width: 820px;">
    <h3>üîç Search Users</h3>
    <div class="search-container">
        <input type="text" id="searchQuery" placeholder="Search by name, username, or email..." style="width: 400px;">
        <button onclick="searchUsers()">Search</button>
    </div>
    <div id="searchResults"></div>
    <button class="close-btn" onclick="closeForm('formSearchUsers')" style="margin-top:12px;">Close</button>
</div>

<!-- Search Students -->
<div id="formSearchStudents" class="popup" style="max-width: 820px;">
    <h3>üîé Search Students</h3>
    <div class="search-container">
        <input type="text" id="searchStudentQuery" placeholder="Search by name, student ID, or email..." style="width: 400px;">
        <button onclick="searchStudents()">Search</button>
    </div>
    <div id="searchStudentResults"></div>
    <button class="close-btn" onclick="closeForm('formSearchStudents')" style="margin-top:12px;">Close</button>
</div>

<!-- User Details -->
<div id="formUserDetails" class="popup">
    <h3>üë§ User Details</h3>
    <div id="userDetailsContent"></div>
    <button class="close-btn" onclick="closeForm('formUserDetails')">Close</button>
</div>

<!-- Student Details -->
<div id="formStudentDetails" class="popup">
    <h3>üéì Student Details</h3>
    <div id="studentDetailsContent"></div>
    <button class="close-btn" onclick="closeForm('formStudentDetails')">Close</button>
</div>

<!-- Edit User -->
<div id="formEditUser" class="popup" style="max-width: 700px;">
    <h3>‚úèÔ∏è Edit User</h3>
    <input type="hidden" id="editUserId">
    <div class="form-grid">
        <div>
            <label>First Name <span class="required">*</span></label>
            <input type="text" id="editFirstName">
        </div>
        <div>
            <label>Middle Name</label>
            <input type="text" id="editMiddleName">
        </div>
    </div>
    <div class="form-grid">
        <div>
            <label>Surname <span class="required">*</span></label>
            <input type="text" id="editSurname">
        </div>
        <div>
            <label>Username <span class="required">*</span></label>
            <input type="text" id="editUsername">
        </div>
    </div>
    <label>Email <span class="required">*</span></label>
    <input type="email" id="editEmail">
    <label>Contact Number <span class="required">*</span></label>
    <input type="tel" id="editContactNumber">
    <div class="form-grid">
        <div>
            <label>Password</label>
            <input type="password" id="editPassword">
            <p class="help-text">Leave blank to keep current password</p>
        </div>
        <div>
            <label>Role <span class="required">*</span></label>
            <select id="editRole">
                <option value="admin">Admin</option>
                <option value="teacher">Teacher</option>
                <option value="student">Student</option>
                <option value="registrar">Registrar</option>
                <option value="cashier">Cashier</option>
                <option value="records">Records</option>
                <option value="faculty">Faculty</option>
            </select>
        </div>
    </div>
    <div style="margin-top: 18px;">
        <button class="submit-btn" onclick="submitEditUser()">Update User</button>
        <button class="close-btn" onclick="closeForm('formEditUser')">Cancel</button>
    </div>
</div>

<!-- Reset Password -->
<div id="formResetPassword" class="popup">
    <h3>üîë Reset Password</h3>
    <input type="hidden" id="resetUserId">
    <input type="hidden" id="resetUserType">
    <p id="resetUsername" style="margin-bottom: 16px; font-weight: 600; color: var(--forest-800);"></p>
    <label>New Password <span class="required">*</span></label>
    <input type="password" id="newPassword">
    <div style="margin-top: 16px;">
        <button class="submit-btn" onclick="submitResetPassword()">Reset Password</button>
        <button class="close-btn" onclick="closeForm('formResetPassword')">Cancel</button>
    </div>
</div>

<!-- Bulk Actions -->
<div id="formBulkActions" class="popup" style="max-width: 900px;">
    <h3>‚ö° Bulk Actions</h3>
    <p style="margin-bottom: 16px; color: var(--text-light); font-size: 13.5px;">Select users and apply bulk status changes across multiple accounts.</p>
    <div class="search-container">
        <button onclick="selectAllUsers()">‚òë Select All</button>
        <button onclick="deselectAllUsers()" style="background: var(--cream-dark); color: var(--text-mid);">‚òê Deselect All</button>
    </div>
    <div style="max-height: 360px; overflow-y: auto; margin-bottom: 16px;">
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th><input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll()"></th>
                        <th>Name</th>
                        <th>Username</th>
                        <th>Role</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="bulkUsersTableBody"></tbody>
            </table>
        </div>
    </div>
    <div class="bulk-actions">
        <button class="submit-btn" onclick="bulkActivate()">‚úÖ Activate Selected</button>
        <button style="background: #95a5a6; color: white; padding:10px 18px; border:none; border-radius:8px; font-weight:600; cursor:pointer;" onclick="bulkDeactivate()">‚õî Deactivate Selected</button>
    </div>
    <button class="close-btn" onclick="closeForm('formBulkActions')" style="margin-top:8px;">Close</button>
</div>

<script>
const API = "";
let allUsers = [];

/* ===== Clock ===== */
function updateClock() {
    const now = new Date();
    document.getElementById("clockTime").textContent = now.toLocaleTimeString('en-PH', {hour:'2-digit', minute:'2-digit', second:'2-digit'});
    document.getElementById("clockDate").textContent = now.toLocaleDateString('en-PH', {weekday:'short', year:'numeric', month:'short', day:'numeric'});
}
setInterval(updateClock, 1000);
updateClock();

/* ===== Utils ===== */
function getToken() {
    const token = localStorage.getItem("jwt");
    if(!token){ alert("Login required"); window.location.href="/login.html"; throw new Error("No token"); }
    return token;
}
async function apiFetch(url, options = {}) {
    options.headers = { "Authorization": "Bearer " + getToken(), "Content-Type": "application/json" };
    const res = await fetch(API + url, options);
    let data = {};
    try { data = await res.json(); } catch {}
    if(!res.ok) throw new Error(data.error || `HTTP ${res.status}`);
    return data;
}
function logout() { localStorage.removeItem("jwt"); window.location.href = "/login.html"; }
function getFullName(user) {
    const parts = [user.first_name, user.middle_name, user.surname || user.last_name].filter(p => p && p.trim());
    return parts.length > 0 ? parts.join(' ') : user.username || user.student_id;
}

/* ===== Popups ===== */
function openForm(id) {
    closeAllForms();
    document.getElementById("overlay").style.display = "block";
    document.getElementById(id).style.display = "block";
    if(id === "formViewUsers") loadUsers();
    if(id === "formViewStudents") loadStudents();
    if(id === "formBulkActions") loadBulkUsers();
    document.querySelectorAll('.sidebar-btn').forEach(b => b.classList.remove('active'));
}
function closeForm(id) { document.getElementById("overlay").style.display = "none"; document.getElementById(id).style.display = "none"; }
function closeAllForms() { document.getElementById("overlay").style.display = "none"; document.querySelectorAll('.popup').forEach(p => p.style.display = 'none'); }

/* ===== Dashboard ===== */
function showDashboard() {
    closeAllForms();
    document.querySelectorAll('.sidebar-btn').forEach(b => b.classList.remove('active'));
    event.currentTarget.classList.add('active');
    loadStats();
}
async function loadStats() {
    try {
        const stats = await apiFetch("/admin/stats");
        document.getElementById("statTotalUsers").textContent = stats.total_users || 0;
        document.getElementById("statActiveUsers").textContent = stats.active_users || 0;
        document.getElementById("statTeachers").textContent = stats.teacher_count || 0;
        document.getElementById("statAdmins").textContent = stats.admin_count || 0;
        document.getElementById("statInactiveUsers").textContent = stats.inactive_users || 0;
        document.getElementById("statTotalStudentsTable").textContent = stats.total_students || 0;
    } catch(e) { console.error("Failed loading stats:", e); }
}

/* ===== Load Users ===== */
async function loadUsers() {
    try {
        const role = document.getElementById("filterRole").value;
        const status = document.getElementById("filterStatus").value;
        let url = "/admin/users?";
        if(role) url += `role=${role}&`;
        if(status) url += `status=${status}&`;
        const users = await apiFetch(url);
        const usersList = Array.isArray(users) ? users : [];
        const tbody = document.getElementById("userTableBody");
        if(usersList.length === 0) {
            tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;color:var(--text-light);padding:20px;">No users found</td></tr>';
            return;
        }
        tbody.innerHTML = usersList.map(u => {
            const statusBadge = u.status === 'active' ? `<span class="status-badge status-active">Active</span>` : `<span class="status-badge status-inactive">Inactive</span>`;
            const fullName = getFullName(u);
            return `<tr>
                <td>${u.id}</td>
                <td><strong>${fullName}</strong></td>
                <td>${u.email || '‚Äì'}</td>
                <td>${u.contact_number || '‚Äì'}</td>
                <td style="font-family:monospace;font-size:12.5px;">${u.username}</td>
                <td><span style="background:var(--cream);padding:3px 8px;border-radius:4px;font-size:12px;font-weight:600;color:var(--forest-800);">${u.role}</span></td>
                <td>${statusBadge}</td>
                <td>
                    <button class="action-btn btn-details" onclick="viewUserDetails(${u.id})">Details</button>
                    <button class="action-btn btn-edit" onclick="editUserById(${u.id})">Edit</button>
                    <button class="action-btn btn-reset" onclick="resetPassword(${u.id},'${fullName.replace(/'/g,"\\'")}',' user')">Pwd</button>
                    ${u.status === 'active' ? `<button class="action-btn btn-deactivate" onclick="toggleStatus(${u.id},'inactive')">Deactivate</button>` : `<button class="action-btn btn-activate" onclick="toggleStatus(${u.id},'active')">Activate</button>`}
                    <button class="action-btn btn-delete" onclick="deleteUser(${u.id})">Delete</button>
                </td>
            </tr>`;
        }).join('');
    } catch(e) { alert("Failed loading users: " + e.message); }
}

/* ===== Load Students ===== */
async function loadStudents() {
    try {
        const status = document.getElementById("filterStudentStatus").value;
        let url = "/admin/students?";
        if(status) url += `status=${status}`;
        const students = await apiFetch(url);
        const studentsList = Array.isArray(students) ? students : [];
        const tbody = document.getElementById("studentTableBody");
        if(studentsList.length === 0) {
            tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;color:var(--text-light);padding:20px;">No students found</td></tr>';
            return;
        }
        tbody.innerHTML = studentsList.map(s => {
            let statusBadge;
            if(s.status === 'approved') statusBadge = '<span class="status-badge status-approved">Approved</span>';
            else if(s.status === 'pending') statusBadge = '<span class="status-badge status-pending">Pending</span>';
            else statusBadge = '<span class="status-badge status-rejected">Rejected</span>';
            const fullName = getFullName(s);
            return `<tr>
                <td>${s.id}</td>
                <td style="font-family:monospace;font-size:12.5px;">${s.student_id}</td>
                <td><strong>${fullName}</strong></td>
                <td>${s.email || '‚Äì'}</td>
                <td>${s.contact_number || '‚Äì'}</td>
                <td>${s.age || '‚Äì'}</td>
                <td>${statusBadge}</td>
                <td>
                    <button class="action-btn btn-details" onclick="viewStudentDetails(${s.id})">Details</button>
                    <button class="action-btn btn-reset" onclick="resetPassword(${s.id},'${fullName.replace(/'/g,"\\'")}','student')">Pwd</button>
                    ${s.status !== 'approved' ? `<button class="action-btn btn-approve" onclick="toggleStudentStatus(${s.id},'approved')">Approve</button>` : ''}
                    ${s.status !== 'pending' ? `<button class="action-btn btn-pending" onclick="toggleStudentStatus(${s.id},'pending')">Pending</button>` : ''}
                    ${s.status !== 'rejected' ? `<button class="action-btn btn-reject" onclick="toggleStudentStatus(${s.id},'rejected')">Reject</button>` : ''}
                    <button class="action-btn btn-delete" onclick="deleteStudent(${s.id})">Delete</button>
                </td>
            </tr>`;
        }).join('');
    } catch(e) { alert("Failed loading students: " + e.message); }
}

async function loadBulkUsers() {
    try {
        const users = await apiFetch("/admin/users");
        allUsers = users;
        const tbody = document.getElementById("bulkUsersTableBody");
        tbody.innerHTML = users.map(u => {
            const statusBadge = u.status === 'active' ? `<span class="status-badge status-active">Active</span>` : `<span class="status-badge status-inactive">Inactive</span>`;
            return `<tr>
                <td><input type="checkbox" class="user-checkbox" value="${u.id}"></td>
                <td>${getFullName(u)}</td>
                <td style="font-family:monospace;font-size:12.5px;">${u.username}</td>
                <td>${u.role}</td>
                <td>${statusBadge}</td>
            </tr>`;
        }).join('');
    } catch(e) { alert("Failed loading users: " + e.message); }
}

/* ===== User Actions ===== */
async function viewUserDetails(userId) {
    try {
        const user = await apiFetch(`/admin/users/${userId}/details`);
        const content = document.getElementById("userDetailsContent");
        const createdDate = new Date(user.created_at).toLocaleString();
        const fullName = getFullName(user);
        const statusBadge = user.status === 'active' ? '<span class="status-badge status-active">Active</span>' : '<span class="status-badge status-inactive">Inactive</span>';
        content.innerHTML = `<div class="user-details">
            <p><strong>ID:</strong> ${user.id}</p>
            <p><strong>Full Name:</strong> ${fullName}</p>
            <p><strong>First Name:</strong> ${user.first_name || '‚Äì'}</p>
            <p><strong>Middle Name:</strong> ${user.middle_name || '‚Äì'}</p>
            <p><strong>Surname:</strong> ${user.surname || '‚Äì'}</p>
            <p><strong>Email:</strong> ${user.email || '‚Äì'}</p>
            <p><strong>Contact:</strong> ${user.contact_number || '‚Äì'}</p>
            <p><strong>Username:</strong> <span style="font-family:monospace">${user.username}</span></p>
            <p><strong>Role:</strong> ${user.role}</p>
            <p><strong>Status:</strong> ${statusBadge}</p>
            <p><strong>Created:</strong> ${createdDate}</p>
        </div>`;
        openForm('formUserDetails');
    } catch(e) { alert("Failed to load user details: " + e.message); }
}

async function viewStudentDetails(studentId) {
    try {
        const student = await apiFetch(`/admin/students/${studentId}/details`);
        const content = document.getElementById("studentDetailsContent");
        const createdDate = new Date(student.created_at).toLocaleString();
        const fullName = getFullName(student);
        let statusBadge;
        if(student.status === 'approved') statusBadge = '<span class="status-badge status-approved">Approved</span>';
        else if(student.status === 'pending') statusBadge = '<span class="status-badge status-pending">Pending</span>';
        else statusBadge = '<span class="status-badge status-rejected">Rejected</span>';
        content.innerHTML = `<div class="user-details">
            ${student.profile_picture ? `<img src="${student.profile_picture}" class="profile-pic" style="display:block;margin:0 auto 16px;">` : ''}
            <p><strong>ID:</strong> ${student.id}</p>
            <p><strong>Student ID:</strong> <span style="font-family:monospace">${student.student_id}</span></p>
            <p><strong>Full Name:</strong> ${fullName}</p>
            <p><strong>First Name:</strong> ${student.first_name || '‚Äì'}</p>
            <p><strong>Middle Name:</strong> ${student.middle_name || '‚Äì'}</p>
            <p><strong>Last Name:</strong> ${student.last_name || '‚Äì'}</p>
            <p><strong>Age:</strong> ${student.age || '‚Äì'}</p>
            <p><strong>Email:</strong> ${student.email || '‚Äì'}</p>
            <p><strong>Contact:</strong> ${student.contact_number || '‚Äì'}</p>
            <p><strong>Address:</strong> ${student.address || '‚Äì'}</p>
            <p><strong>Status:</strong> ${statusBadge}</p>
            <p><strong>Created:</strong> ${createdDate}</p>
        </div>`;
        openForm('formStudentDetails');
    } catch(e) { alert("Failed to load student details: " + e.message); }
}

async function editUserById(userId) {
    try {
        const user = await apiFetch(`/admin/users/${userId}/details`);
        document.getElementById("editUserId").value = user.id;
        document.getElementById("editFirstName").value = user.first_name || '';
        document.getElementById("editMiddleName").value = user.middle_name || '';
        document.getElementById("editSurname").value = user.surname || '';
        document.getElementById("editUsername").value = user.username;
        document.getElementById("editEmail").value = user.email || '';
        document.getElementById("editContactNumber").value = user.contact_number || '';
        document.getElementById("editRole").value = user.role;
        document.getElementById("editPassword").value = "";
        openForm('formEditUser');
    } catch(e) { alert("Failed to load user: " + e.message); }
}

async function submitEditUser() {
    const id = document.getElementById("editUserId").value;
    const firstName = document.getElementById("editFirstName").value.trim();
    const middleName = document.getElementById("editMiddleName").value.trim();
    const surname = document.getElementById("editSurname").value.trim();
    const username = document.getElementById("editUsername").value.trim();
    const email = document.getElementById("editEmail").value.trim();
    const contactNumber = document.getElementById("editContactNumber").value.trim();
    const password = document.getElementById("editPassword").value.trim();
    const role = document.getElementById("editRole").value;
    if(!firstName || !surname || !username || !email || !contactNumber || !role) { alert("Please fill all required fields"); return; }
    const body = { first_name: firstName, middle_name: middleName, surname: surname, username: username, email: email, contact_number: contactNumber, role: role };
    if(password) body.password = password;
    try {
        await apiFetch(`/admin/users/${id}`, {method: "PUT", body: JSON.stringify(body)});
        alert("User updated successfully");
        closeForm('formEditUser');
        loadUsers();
    } catch(e) { alert("Failed to update user: " + e.message); }
}

function resetPassword(id, fullName, userType) {
    document.getElementById("resetUserId").value = id;
    document.getElementById("resetUserType").value = userType;
    document.getElementById("resetUsername").textContent = `Reset password for: ${fullName}`;
    document.getElementById("newPassword").value = "";
    openForm('formResetPassword');
}

async function submitResetPassword() {
    const id = document.getElementById("resetUserId").value;
    const userType = document.getElementById("resetUserType").value;
    const newPassword = document.getElementById("newPassword").value.trim();
    if(!newPassword) { alert("Please enter a new password"); return; }
    try {
        const endpoint = userType === 'student' ? `/admin/students/${id}/reset-password` : `/admin/users/${id}/reset-password`;
        await apiFetch(endpoint, { method: "POST", body: JSON.stringify({ new_password: newPassword }) });
        alert("Password reset successfully");
        closeForm('formResetPassword');
    } catch(e) { alert("Failed to reset password: " + e.message); }
}

async function toggleStatus(userId, newStatus) {
    if(!confirm(`Are you sure you want to ${newStatus === 'active' ? 'activate' : 'deactivate'} this user?`)) return;
    try {
        await apiFetch(`/admin/users/${userId}/status`, { method: "PUT", body: JSON.stringify({ status: newStatus }) });
        alert("User status updated");
        loadUsers();
        loadStats();
    } catch(e) { alert("Failed to update status: " + e.message); }
}

async function toggleStudentStatus(studentId, newStatus) {
    if(!confirm(`Change this student's status to "${newStatus}"?`)) return;
    try {
        await apiFetch(`/admin/students/${studentId}/status`, { method: "PUT", body: JSON.stringify({ status: newStatus }) });
        alert("Student status updated");
        loadStudents();
    } catch(e) { alert("Failed to update student status: " + e.message); }
}

async function deleteUser(id) {
    if(!confirm("Delete this user? This action cannot be undone.")) return;
    try {
        await apiFetch(`/admin/users/${id}`, {method: "DELETE"});
        alert("User deleted successfully");
        loadUsers();
        loadStats();
    } catch(e) { alert("Failed to delete user: " + e.message); }
}

async function deleteStudent(id) {
    if(!confirm("Delete this student? This action cannot be undone.")) return;
    try {
        await apiFetch(`/admin/students/${id}`, {method: "DELETE"});
        alert("Student deleted successfully");
        loadStudents();
    } catch(e) { alert("Failed to delete student: " + e.message); }
}

/* ===== Search ===== */
async function searchUsers() {
    const query = document.getElementById("searchQuery").value.trim();
    if(!query) { alert("Please enter a search term"); return; }
    try {
        const users = await apiFetch(`/admin/search?q=${encodeURIComponent(query)}`);
        const resultsDiv = document.getElementById("searchResults");
        if(!users || users.length === 0) { resultsDiv.innerHTML = '<p style="margin-top:14px;color:var(--text-light);">No users found.</p>'; return; }
        resultsDiv.innerHTML = `<div class="table-wrapper" style="margin-top:14px;"><table>
            <thead><tr><th>Name</th><th>Email</th><th>Username</th><th>Role</th><th>Status</th><th>Actions</th></tr></thead>
            <tbody>${users.map(u => {
                const statusBadge = u.status === 'active' ? `<span class="status-badge status-active">Active</span>` : `<span class="status-badge status-inactive">Inactive</span>`;
                return `<tr>
                    <td>${getFullName(u)}</td>
                    <td>${u.email || '‚Äì'}</td>
                    <td style="font-family:monospace;font-size:12.5px;">${u.username}</td>
                    <td>${u.role}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="action-btn btn-details" onclick="viewUserDetails(${u.id})">Details</button>
                        <button class="action-btn btn-edit" onclick="editUserById(${u.id})">Edit</button>
                    </td>
                </tr>`;
            }).join('')}</tbody>
        </table></div>`;
    } catch(e) { alert("Search failed: " + e.message); }
}

async function searchStudents() {
    const query = document.getElementById("searchStudentQuery").value.trim();
    if(!query) { alert("Please enter a search term"); return; }
    try {
        const students = await apiFetch(`/admin/students/search?q=${encodeURIComponent(query)}`);
        const resultsDiv = document.getElementById("searchStudentResults");
        if(!students || students.length === 0) { resultsDiv.innerHTML = '<p style="margin-top:14px;color:var(--text-light);">No students found.</p>'; return; }
        resultsDiv.innerHTML = `<div class="table-wrapper" style="margin-top:14px;"><table>
            <thead><tr><th>Student ID</th><th>Name</th><th>Email</th><th>Contact</th><th>Status</th><th>Actions</th></tr></thead>
            <tbody>${students.map(s => {
                let statusBadge;
                if(s.status === 'approved') statusBadge = '<span class="status-badge status-approved">Approved</span>';
                else if(s.status === 'pending') statusBadge = '<span class="status-badge status-pending">Pending</span>';
                else statusBadge = '<span class="status-badge status-rejected">Rejected</span>';
                return `<tr>
                    <td style="font-family:monospace;font-size:12.5px;">${s.student_id}</td>
                    <td>${getFullName(s)}</td>
                    <td>${s.email || '‚Äì'}</td>
                    <td>${s.contact_number || '‚Äì'}</td>
                    <td>${statusBadge}</td>
                    <td><button class="action-btn btn-details" onclick="viewStudentDetails(${s.id})">Details</button></td>
                </tr>`;
            }).join('')}</tbody>
        </table></div>`;
    } catch(e) { alert("Search failed: " + e.message); }
}

/* ===== Bulk Actions ===== */
function toggleSelectAll() {
    const selectAll = document.getElementById("selectAllCheckbox").checked;
    document.querySelectorAll(".user-checkbox").forEach(cb => cb.checked = selectAll);
}
function selectAllUsers() { document.getElementById("selectAllCheckbox").checked = true; toggleSelectAll(); }
function deselectAllUsers() { document.getElementById("selectAllCheckbox").checked = false; toggleSelectAll(); }
function getSelectedUserIds() {
    return Array.from(document.querySelectorAll(".user-checkbox:checked")).map(cb => parseInt(cb.value));
}

async function bulkActivate() {
    const userIds = getSelectedUserIds();
    if(userIds.length === 0) { alert("Please select at least one user"); return; }
    if(!confirm(`Activate ${userIds.length} user(s)?`)) return;
    try {
        await apiFetch("/admin/users/bulk-status", { method: "POST", body: JSON.stringify({ user_ids: userIds, status: "active" }) });
        alert(`Successfully activated ${userIds.length} user(s)`);
        loadBulkUsers();
        loadStats();
    } catch(e) { alert("Bulk activation failed: " + e.message); }
}

async function bulkDeactivate() {
    const userIds = getSelectedUserIds();
    if(userIds.length === 0) { alert("Please select at least one user"); return; }
    if(!confirm(`Deactivate ${userIds.length} user(s)?`)) return;
    try {
        await apiFetch("/admin/users/bulk-status", { method: "POST", body: JSON.stringify({ user_ids: userIds, status: "inactive" }) });
        alert(`Successfully deactivated ${userIds.length} user(s)`);
        loadBulkUsers();
        loadStats();
    } catch(e) { alert("Bulk deactivation failed: " + e.message); }
}

/* ===== Create User ===== */
document.getElementById("submitCreateUser").onclick = async () => {
    const firstName = document.getElementById("userFirstName").value.trim();
    const middleName = document.getElementById("userMiddleName").value.trim();
    const surname = document.getElementById("userSurname").value.trim();
    const username = document.getElementById("userUsername").value.trim();
    const email = document.getElementById("userEmail").value.trim();
    const contactNumber = document.getElementById("userContactNumber").value.trim();
    const password = document.getElementById("userPassword").value.trim();
    const role = document.getElementById("userRole").value;
    if(!firstName || !surname || !username || !email || !contactNumber || !password || !role) { alert("Please fill all required fields"); return; }
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if(!emailRegex.test(email)) { alert("Please enter a valid email address"); return; }
    try {
        await apiFetch("/admin/users", { method: "POST", body: JSON.stringify({ first_name: firstName, middle_name: middleName, surname: surname, username: username, email: email, contact_number: contactNumber, password: password, role: role }) });
        alert("User created successfully");
        closeForm("formCreateUser");
        ["userFirstName","userMiddleName","userSurname","userUsername","userEmail","userContactNumber","userPassword"].forEach(id => document.getElementById(id).value = "");
        document.getElementById("userRole").value = "";
        loadStats();
    } catch(e) { alert("Failed to create user: " + e.message); }
};

/* ===== Init ===== */
window.onload = () => { loadStats(); };
</script>
</body>
</html>